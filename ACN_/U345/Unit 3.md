Mobile-IP Introduction Mobility: mobile computing refers to a system that allows computers to move from one location to another. Mobility is associated with wireless technologies that allow movement across long distances at required speed. The main issue with mobility is the addressing(IP) of the host when it moves from one network to another. Note: Unplugging a desktop computer and plugging it into a different network requires reconfiguring IP. Limitation of Conventional IP for Mobility

![[Pasted image 20260211223455.png]]
((limitation of conventional IP for Mobility))

Limitation of Conventional IP for Mobility (Contd) IP employs 32-bit address which has two parts, network identifier and host identifier This addressing scheme may not work directly as the mobile hosts may move from one subnet to another, but the packets addressed to the mobile host may be delivered to the old subnet to which the node was originally attached, as illustrated in Figures (b) and (c). Hence the traditional IP addressing is not supportive of address mobility which is essential in wireless Internet. Figure in previous slide shows the mobility of a node (with IP address 10.6.6.1) attached to subnet A (subnet address 10.6.6.x) moving over to another subnet B with address 10.6.15.x. In this case, the packets addressed to the node will be routed to the subnet A instead of the subnet B, as the network part in the mobile node's address is 10.6.6.x. Mobile IP is a solution that uses an address redirection mechanism for this address mobility issue in wireless Internet. The IETF(Internet Engineering Task Force) devised a solution to the mobility problem that overcomes some of the limitations of the original IP addressing scheme i.e, Mobile IP Mobile IP Characteristics The general characteristics of Mobile IP are Transparency: Mobility is transparent to applications and transport layer protocols as well as to routers not involved in the change, in the sense that the user should not feel a difference when working in a wireless domain or in a wired one. Scalability: The solution scales to large internets. In particular, it permits mobility across the global Internet. So the solution should be scalable to support a large number of users. Security: Mobile IP provides security facilities that can be used to ensure all messages are authenticated. Compatibility/Interoperability: A host using mobile IP can interoperate with stationary hosts that run conventional IPv4 software as well as with other mobile hosts. Macro mobility: mobile IP focuses on the problem of long-duration moves. For example, mobile IP works well for a user who takes a portable computer on a business trip, and leaves it attached to the new location for a week Mobile IP Entities Mobile Node (MN): Mobile node (MN) is a mobile terminal system (end user) or a mobile router. It is the host for which the mobility support is to be provided. It may change its point of attachment from network to network in the Internet. MN is assigned a permanent IP called its home address to which other hosts send packets regardless of MN’s location Home Network: It is a network to which the mobile node originally belongs to as per its assigned IP address (home address). The subnet to which the MN's IP address belongs is the home network. Home Agent (HA): The router or node under whose domain home IP address lies is the home agent (HA). Located on home network of MN. It binds primary address of MN with its COA. HA forwards packets to appropriate network when MN is away using encapsulation. Foreign Network:The current network in which the MN lies when it is away from Home network. Foreign Agent (FA): A router in foreign network to which MN is currently connected. ThepacketsfromtheHAaresenttotheFAwhichdeliversittotheMN Mobile IP Entities (Contd.) Correspondent Node (CN): It is a device on the internet communicating to the mobile node. It may be a fixed or a mobile node. Ex a Web browser. Primary/Home address: is permanent and fixed. It is the address applications and transport protocols use. A mobile host obtains a primary address on its original, home network. Secondary/ Care Of Address: is temporary - it changes as the computer moves, and is valid only while the computer visits a given location. Once the host moves to a foreign network, it obtains a secondary address and sends it to an HA at home. There are two types of COA Foreign Agent COA: The COA is an IP address of the foreign agent. The foreign agent is the tunnel endpoint and forwards packets to the MN. Many MN using the FA can share this COA as common COA. For using a FA care-of address, a MN must first discover the identity of an agent, and then contact the agent to obtain a care-of address. Co-located COA: The COA is co-located if the MN temporarily acquired an additional IP address which acts as a COA. This address is now topologically correct, and the tunnel endpoint is at the mobile node. Co-located address can be acquired using services such as DHCP. Co-located COA, requires a mobile computer to handle all forwarding itself. MN that uses a co-located COA will have software that uses two addresses simultaneously - applications use the home address and lower layer software uses the COA to receive datagram. Advantage: It can work with existing internet infrastructure. Routers on the foreign network do not know whether a computer is mobile or fixed node of same network. COA are allocated to mobile computers by the same mechanisms used to allocate addresses to fixed computers, i.e DHCP Disadvantage: MN requires extra software required - the mobile must contain facilities to obtain an address and to communicate with the home agent. 

Mobile IP Entities (Contd.)
((working of mobile ip entitiens))
![[Pasted image 20260211223636.png]]
 Mobile IP Entities (Contd.) Note : Mobile IP is intended for situations in which a host moves infrequently and remains at a given location for a relatively long period of time. Mobility lies in allowing a host to retain its address without requiring routers to learn host-specific routes. Mobile IP solves the problem by allowing a single computer to hold two addresses simultaneously. Mobile IP Entities (Contd.) Overview Of Mobile IP Operation Once the host moves to a foreign network, it obtains a secondary address and sends the secondary address to HA at home network. The agent agrees to intercept datagrams sent to the mobile's primary address, and uses IP-in-IP encapsulation to tunnel each datagram to the secondary address. CN sends the data to the MN through HA. Data packets Contains Correspondent node’s address (Source) and home address (Destination). Packets reaches to the HA. But now mobile node is not in the home network, it has moved into the foreign network. FA sends the COA to the HA to which all the packets should be sent. Now, a tunnel will be established between the home agent and the FA by the process of tunneling. Now, HA encapsulates the data packets into new packets in which the source address is the home address and destination is the COA and sends it through the tunnel to the FA. The FA, on other side of the tunnel receives the data packets, de- capsulate them and sends them to the MN. MN in response to the data packets received, sends a reply in response to FA. FA directly sends the reply to the correspondent node. Overview Of Mobile IP Operation (Contd) 

![[Pasted image 20260211223740.png]]
 ((diagrma of mobile ip operation))
 Overview Of Mobile IP Operation (Contd) Suppose MN is currently in the subnet 130.111.*, hence as shown in the figure, 30.111.111.111 becomes the FA for MN. If CN sends a packet to MN, it reaches the HA of MN (130.103.202.050) along Path I.HA cannot find MN in the home network, but if it knows the location of MN, it can send the packet along Path II by creating a tunnel. Mobile IP Support Services Supporting Services for Mobile IP operation Agent Discovery, Registration, Encapsulation and De-capsulation. Agent Discovery: The process of finding a foreign agent uses the ICMP router discovery mechanism. Each router periodically send an ICMP router advertisement message, and allows a host to send an ICMP router solicitation to prompt for an advertisement. In agent discovery method, an additional information called Mobility Agent Extension is appended to each router advertisement message. A mobile host concludes that the extension is present when the datagram length specified in the IP header is greater than the length of the ICMP router discovery message. MAE used to convey Mobile IP capabilities of the agent to MN on the network. Mobility Agent Advertisement Extension message.
 ((flags diagram))
  ![[Pasted image 20260211223842.png]]
  
  Length Type Sequence Registration Life Time RBHFMGrT Reserved Zero or more Care-of-Address 0 8 16 31 Type: 1 byte, identifies the Agent Advertisement extension type. For the Mobility Agent Advertisement Extension, it is set to 16. Length: 1 byte, it indicates the length of the extension in bytes, excluding the Type and Length fields. Thus, it is equal to 6 plus 4 for each care-of address in the message. Sequence Number: 2 bytes, A sequential counter set to zero when the router initializes and then incremented for each advertisement sent out. Registration Lifetime : 2 bytes, The maximum length of time, in seconds, the agent is willing to accept for registration requests. This field is for registration only and has no relation to the regular Lifetime field in the regular Router Advertisement part of the message. COA: 4 bytes Zero or more addresses provided by a foreign agent for a mobile node to use as a FA COA. A FA must always provide at least one address in its advertisement; a router that cannot act as a foreign agent will typically omit this field Mobility Agent Advertisement Extension message. Mobile IP Support Services (Agent Registration) . When MN is away from , it registers its COA with its HA , typically through the FA. Registration control messages are sent via UDP to well known port(434). Before it can receive datagram at a foreign network, a MN must register. If MN obtains a care-of address from a FA, MN after discovering the FA, sends registration request (RREQ) to the FA. FA in turn, sends the registration request to the HA with the COA. HA sends registration reply (RREP) to the FA. Then it forwards the registration reply to the MN and completes the process of registration. If it obtains a colocated care-of address, a mobile preforms all necessary registration directly; the mobile can use the address to communicate with its home agent and register. Mobile IP Support Services (Agent Registration) . 
  ((mobile ip support services agent reg diagram))
  ![[Pasted image 20260211223958.png]]
  
  Agent Registration Message Format Type=1 SBDMGRTX Life Time Registration Life Time RBHFMGV Reserved Home Address Home Agent Care-Of-Address 0 8 16 31 Type: 1 byte, Identifies the registration message type. For a request, this field is 1. Lifetime: 2 bytes Length of time, in seconds, that the mobile node requests from the home agent for this registration. Home Address: 4 bytes, the home IP address of the MN when on its home network. Uniquely identifies the device regardless of how the request is conveyed to the HA. Home Agent: 4 bytes The IP address of the device acting as the mobile node's HA Extensions: variable bytes, Extension fields are included here for authentication of the request. Other extensions may also be included Agent Registration Message Format 

![[Pasted image 20260211224044.png]]
((flags diagram))
  
  Communication of Mobile Node with A Foreign Agent In case of FA-COA, FA assigns one of its IP to MN, then a mobile will not have a unique address on the foreign network, then how can a FA and a mobile host communicate over a network if the MN does not have a valid IP address on the network? Hence when a MN sends to a FA, the MN is allowed to use its home address as an IP source address. Furthermore, when a FA sends a datagram to a mobile, the FA is allowed to use the mobile's home address as an IP destination address. But an agent is not allowed to ARP for the address. To perform address binding without ARP, an agent is required to record all information about a mobile when a registration request arrives and to keep the information (MAC Id) during communication. Although ARP is not used, the agent can send datagrams to a mobile by refereeing the stored information via hardware unicast The Two-Crossing Problem The major disadvantage of mobile IP is inefficient routing, known as 2X problem or Double Crossing. This problem raises as the MN uses its Home Address for communication, even when it is in Foreign Network. Consider communication between the MN and destination host D, on same network as the mobile. Datagram from MN to D travel through router R4 , and are then delivered to D. However, because datagrams sent from D to MN contain MN's home address, they follow a path through R3 , and across the internet to the mobile's home network. When the datagrams reach R1 , (the mobile's home agent), they are tunneled back across the internet to the foreign site (either directly to MN or to a foreign agent). Because crossing an internet is much more expensive than local delivery, the situation described above is known as the two crossing problem, and is sometimes called the 2X problem. Eliminating the problem requires propagating host-specific routes; the problem remains for any destination that does not receive the host-specific route. The Two-Crossing Problem

![[Pasted image 20260211224115.png]]
   ((two crossing diagram))
   (Contd.,) Communication With Computers On the Home Network The home agent is the router that connects the mobile's home network to the rest of the internet. Hence all the datagrams indented for a host pass through HA. Before forwarding a datagram, the HA examines its table of mobile hosts to determine whether the destination host is currently at home or visiting a foreign network. What happens when a host on the mobile's home network sends a datagram to a MN. Because IP specifies direct delivery over the local network, the sender will not forward the datagram to a router. Instead, the sender will ARP for the mobile's hardware address, encapsulate the datagram, and transmit it. If a mobile has moved to a foreign network, the home agent must intercept all datagrams, including those sent by local hosts. To do this a home agent must listen for ARP requests that specify the mobile as a target, and must answer the requests by supplying its own hardware address. Proxy ARP is completely transparent to local computers - any local system that ARPs for a mobile's address will receive a reply, and will forward the datagram as usual. Private And Hybrid Networks The major drawbacks of a single-level internet architecture is the lack of privacy. Organizations with multiple sites: The private data may pass through the networks of other organization (internet) which may lead to security issues. Two level internet architecture: It distinguishes b/n internal (datagrams of same organization) and external datagrams ( Datagrams between the computers of different organizations). The goal is to keep internal datagrams private while commination through external communication. Private Network: An organization should have its own TCP/IP internet separate from the global Internet. Uses routers and leased digital circuits to interconnect the sites. All data remains private because no outsiders have access to any part of a private network. It can use arbitrary IP addresses. Private And Hybrid Networks (Contd.,) Hybrid Network: This architecture combines the advantages of private networking with the advantages of global Internet connectivity. The private organizations uses globally valid IP addresses and connects each site to the Internet. The advantage is computers in the organization can access the global Internet and also can maintain the privacy when communicating internally. 
![[Pasted image 20260211224141.png]]

   
   Virtual Private Networks The main disadvantage of either a completely Private network or a Hybrid network is the high cost because of leased line. VPN enables organizations to uses the global Internet to connect its sites and keep its data private. A VPN is private in the same way as a private network, but the technology conceals the communication between any pair of computers from outsiders. VPN uses global Internet to pass traffic from one site to another instead of leased lines. Two basic concepts behind VPN are Tunneling and Encryption. VPN define a tunnel across the global Internet between a router at one site and a router at another, and use IP-in-IP encapsulation to forward datagram across the tunnel. VPN encrypts each outgoing datagram before encapsulating it in IP-in-IP Encapsulation used with a VPN 
   ![[Pasted image 20260211224205.png]]
   ((illustrion of ip in ip encapsulation used with a vpn))
   
   The entire inner datagram, including the header, is encrypted before being encapsulated. When a datagram arrives over a tunnel, the receiving router decrypts the data area to reproduce the inner datagram, which it then forwards. Even though the outer datagram traverses through global internet as it passes across the tunnel, outsiders cannot decode the contents because they do not have the encryption key. VPN Addressing And Routing Each VPN tunnel as a replacement for a leased circuit in a private network. As in the private network case, a router contains explicit routes for destinations within the organization. And VPN routes the data through a tunnel instead of leased line.

![[Pasted image 20260211224342.png]]
((a vpn that spans two sidtes and r1s routing table ))
	
VPN Addressing And Routing Assume a datagram sent from a computer on network 128.10.2.0 to a computer on network 128.210.0.0. The sending host forwards the datagram to R2, which forwards it to R1. According to the routing table in R1, the datagram must be sent across the tunnel to R3. Therefore R1, encrypts the datagram, encapsulates it in the data area of an outer datagram with destination R3. R1, then forward the outer datagram through the local ISP and across the Internet. The datagram arrives at R3, which recognizes it as tunneled from R1. R3, decrypts the data area to produce the original datagram, looks up the destination in its routing table, and forwards the datagram to R4, for delivery A VPN With Private Addresses Private Network can use their own IP address but VPN uses the global internet only with encryption to communicate across the Organization’s site. If hosts in the VPN do not need general Internet connectivity, the VPN can be configured to use dedicated IP addresses. When private addressing is used, one globally valid IP address is needed at each site for tunnelling.
	
![[Pasted image 20260211224434.png]]
((a vpn with private addresses))
	 
A VPN With Private Addresses (Contd.,) Site 1 uses subnet 10.1.0.0116, while site 2 uses subnet 10.2.0.0116. Only two globally valid addresses are needed. One is assigned to the connection from router R1, to the Internet, and the other is assigned to the connection from R2, to the Internet. Routing tables at the sites specify routes for private addresses; only the VPN tunneling software needs to know about or use the globally valid IP addresses. Hybrid architecture with valid IP addresses must be employed to provide hosts with access to the global Internet. Advantages: Secure access to business servers, Secure online payments. Application Gateway (Appn., level Firewall) Multiple computers at organization site can access the global Internet without assigning a valid IP address, because of this Application Gateway. It offers hosts to access Internet services without offering IP-level access. Each site will have a multi-homed host ( host with more than one NIC), connected to both internet(using global IP) and intranet (using private IP). This host runs application programs called Application Gateways to handle each service. Hosts at the site send each request to the appropriate application gateway on the multi-homed host, which accesses the service on the Internet and then relays the information back across the internal network. Advantages : It can work without any changes to the underlying infrastructure or addressing. Dis-advantage: Each application gateway handles only one specific service; multiple gateways are required for multiple services. Network Address Translation (NAT) It is one of the solution that provides IP-level access between hosts at a site and the Internet, without requiring each host at the site to have a globally valid IP address. This technology requires a site to have a single connection to the global Internet and at least one globally valid IP address which is assigned to a computer (a multi-homed host or a router) that connects the site to the Internet and runs NAT software. NAT box: A computer with NAT software. All incoming and out going datagrams pass through NAT box. It replaces the source address in each outgoing datagram with Global IP address and replaces the destination address in each incoming datagram with the private address of the correct host. For internal hosts, the NAT boxappearstobearouterthatcanreachtheglobalInternet. Network Address Translation (NAT) Contd., Network Address Translation (NAT) Contd., 
![[Pasted image 20260211224549.png]]
((nat diagram))

Advantages: Generality: it allows an arbitrary internal host to access an arbitrary service on a computer in the global Internet. Transparency: NAT is transparent because it allows an internal host to send and receive datagrams using a private (i.e., nomoutabie) address. Conserving IPV4 address space Network Address Translation technology provides transparent IP-level access to the Internet from a host with a private address. NAT Translation Table Creation How NAT knows which internal host should receive a datagram that arrives from the Internet. NAT maintains a translation table that it uses to perform the mapping. Each entry in the table specifies two items: the IP address of a host on the Internet and the internal IP address of a host at the site. When the router receives a packet from a local host containing a private IP address, it changes the source IP address to use its Internet IP address and changes the source port number so it knows which local host process to deliver received packets to. This re-assignment is entered into the translation table. Each process requiring Internet access running on the local network is assigned a new IP address and port number by NAT. Each re-assignment is then entered into the NAT translation table. When the data arives at NAT box, then NAT looks up the datagram's destination address in the translation table, extracts the corresponding address of an internal host, replaces the datagram's destination address with the host's address, and forwards the datagram across the local network to the host NAT Translation Table Creation


![[Pasted image 20260211224640.png]]
(nat table creation table)

NAT Translation Table Creation The NAT translation table must be in place before a datagram arrives from the Internet. The possibilities for NAT table initialization are Manual initialization: A manager configures the translation table manually before any communication occurs. Outgoing datagrams: The table is built as a side-effect of sending datagrams. When it receives a datagram from an internal host, NAT creates an entry in the translation table to record the address of the host and the address of the destination. Incoming name lookups: The table is built as a side-effect of handling domain name lookups. When a host on the Internet looks up the domain name of an internal host to find its IP address, the domain name software creates an entry in the NAT translation table, and then answers the request by sending address G. Thus, from outside the site, it appears that all host names at the site map to address G. NAT Translation Table Creation IP masquerading is a technique that hides an entire IP address space, usually consisting of private IP addresses, behind a single IP address in another, usually public address space. The hidden addresses are changed into a single (public) IP address as the source address of the outgoing IP packets so they appear as originating not from the hidden host but from the routing device itself. Because of the popularity of this technique to conserve IPv4 address space, the term NAT has become virtually synonymous with IP masquerading. Types of address in Network
((types of address in Network))
![[Pasted image 20260211224716.png]]

Inside local address: An IP address that is assigned to a host on the Inside (local) network. Inside global address: IP address that represents one or more inside local IP addresses to the outside world. Outside local address: This is the actual IP address of the destination host in the local network after translation. Outside global address: This is the outside host as seen form the outside network. It is the IP address of the outside destination host before translation. NAT Terminologies Multi-Address NAT In real time, more complex forms of NAT that allow multiple hosts at a site to access a given external address concurrently are used. In this method NAT box is assigned with set of N number of global IP address. When the first internal host accesses a given destination, the NAT box chooses address G1, adds an entry to the translation table, and sends the datagram. If another host initiates contact with the same destination, the NAT box chooses address G2, and so on. Thus, multi-address NAT allows up to N internal hosts to access a given destination concurrently. Types Of NAT Static NAT: It is also known as one to one NAT. A single private IP address is mapped with single Public IP address, i.e a private host address will always be mapped to predetermined public IP. It provides a one-to-one internal to public IP mapping. SNAT is useful when the device inside private network is required to directly accessed by a device in the internet. Example Web hosting. 

![[Pasted image 20260211224738.png]]
((static nat diagram))
![[Pasted image 20260211224808.png]]
((dynamic nat))



Types Of NAT Dynamic NAT: In this type , multiple private IP address are mapped to a pool of public IP address. DNAT makes 1-to-1 mapping b/w private and public IP, but public IP will be selected from pool of public IPs assigned to NAT box. The public to private mapping may vary based on the available public IP address in NAT pool. In DNAT, translations don't exist in the NAT table until the router (NAT box) receives traffic that requires translation. Dynamic translations have a timeout period after which they are purged from the translation table, thus making them available for other internal hosts. Types Of NAT (Contd.,) Source: firewall.cx Types Of NAT (Contd.,) Port Address Translation (PAT): Also known as NAT Overloaded. It is a DNAT in which many local IPs can be mapped to single public IP and the port numbers are used to decide which traffic belongs to which IP. When there is a request from local host to internet, the NAT box changes the source port (TCP or UDP) number with another port number. These port mappings are kept in a table. When the router receive from internet, it will refer the table which keep the port mappings and forward the data packet to the original sender. This is most frequently used as it is cost effective by using single public IP Types Of NAT (Contd.,) Types Of NAT (Contd.,) 

((nat working diagram))
![[Pasted image 20260211224934.png]]

Types Of NAT (Contd.,) The table shows 4 host on private N/W accessing internet. Host 10.0.0.5 & 10.0.0.1 both accessing Web Server on computer 128.10.19.20, source port uniqueness cannot be guaranteed, so NAT assigns a unique port number to each communication that is used on the Internet. The connection request from private host will be (10.0.0.5,21023, 128.10.19.20,80) and (10.0.0.1,386, 128.10.19.20,80). The Internet that receives the datagrams after NAPT will have the address (G, 14003, 128.10.19.20, 80) @ (G, 14010, 128.10.19.20, 80). G is internal global IP. Types Of NAT (Contd.,) Interaction Between NAT And ICMP Changes to an IP address can cause unexpected side-effects in higher layer protocols. NAT must handle ICMP. Suppose an internal host uses ping to test reachability of a destination on the Internet. The host expects to receive an ICMP echo reply for each ICMP echo request message it sends. Thus, NAT must forward incoming echo replies to the correct host. However, NAT does not forward all ICMP messages that arrive from the Internet. If routes in the NAT box are incorrect, for example, an ICMP redirect message must be processed locally. Thus, when an ICMP message arrives from the Internet, NAT must first determine whether the message should be handled locally or sent to an internal host. Before forwarding to an internal host, NAT translates the ICMP message. NAT device must permit ICMP Queries and their associated responses, when the Query is initiated from a private host to the external hosts. The NAT device transparently forward ICMP Query packets and the responses to these Query packets. A NAPT device further translates the ICMP Query Id and the associated checksum in the ICMP header prior to forwarding. In general, NAT will not work with any application that sends IP addresses or protocol ports as data. Interaction Between NAT And ICMP Autonomous System • Collection of networks and routers under one administrative authority • Free to choose internal routing update mechanism • Connects to one or more other autonomous system https://www.youtube.com/watch?v=LPXi1j-FImo Routing Area Single autonomous system (AS) can be divided into smaller groups called areas. This reduces the number of link-state advertisements (LSAs) and other OSPF overhead traffic sent on the network, and it reduces the size of the topology.